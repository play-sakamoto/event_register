# Eventãƒ¬ã‚¸

## ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦
å¹´ã«æ•°æ—¥ã ã‘å±‹å°ãƒ»éœ²å¤©ã‚’å‡ºã™å°è¦æ¨¡åº—èˆ—ãŒ **ã‚¹ãƒãƒ›ï¼ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ1å°ã§ã™ãã«ä½¿ãˆã‚‹ãƒ¬ã‚¸ã‚µãƒ¼ãƒ“ã‚¹**webã‚¢ãƒ—ãƒª
å•†å“ã‚’é¸æŠã™ã‚‹ã¨åˆè¨ˆé‡‘é¡è¡¨ç¤ºã•ã‚Œã€è²©å£²ãƒ­ã‚°ã‚’ä¿å­˜
ã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†å¾Œã¯ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§æ—¥å ±ãƒ»å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã‚‹

---

## æƒ³å®šã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤
- **åœ°æ–¹ã®ç¥­ã‚Šãƒ»å­¦åœ’ç¥­ãƒ»ãƒ•ãƒªãƒ** ãªã©ã§å¹´ã«æ•°å›å‡ºåº—ã™ã‚‹å€‹äººå•†åº—ä¸»ãƒ»è‡ªæ²»ä¼š
- **å¹´é½¢** : 30ã€œ70æ­³  
- **ITãƒªãƒ†ãƒ©ã‚·ãƒ¼** : ã‚¹ãƒãƒ›åˆ©ç”¨çµŒé¨“ã‚ã‚Šï¼POSã‚¢ãƒ—ãƒªæœªçµŒé¨“  
- **ä¾¡å€¤è¦³** : å°å…¥ã‚³ã‚¹ãƒˆæœ€å°ãƒ»è¨­å®šæœ€çŸ­ãƒ»ç¾é‡‘å›è»¢ç‡å‘ä¸Š

---

## ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
### ãƒ¦ãƒ¼ã‚¶ãƒ¼èª²é¡Œã¨è§£æ±º
| èª²é¡Œ | æä¾›ä¾¡å€¤ |
|------|----------|
|ãã‚‚ãã‚‚å¸³ç°¿ã‚’ã¤ã‘ã¦ã„ãªã„|ä¼šè¨ˆãƒ­ã‚°ã‚’ã¤ã‘ã€è²¡å‹™å‡¦ç†ã®è² æ‹…è»½æ¸›|
| æ‰‹æ›¸ããƒ¡ãƒ¢ã¨æš—ç®—ã§ä¼šè¨ˆã—ã€ãƒŸã‚¹ãŒå¤šã„ | ä¼šè¨ˆã¨ãƒ­ã‚°ã‚’åŒæ™‚å‡¦ç† |
| å£²ä¸Šé›†è¨ˆã«æ™‚é–“ãŒã‹ã‹ã‚Šã€ç¿Œå¹´ã«æ´»ã‹ã›ãªã„ | å£²ã‚Šä¸Šã’ãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆã€CSV/PDFã§å³å…±æœ‰ |

### é–‹ç™ºå‹•æ©Ÿ
å¤ç¥­ã‚Šã§å®Ÿå®¶ã®éœ²åº—ã®ä¼šè¨ˆã‚’æ‹…å½“ã—ãŸéš›ã€å¸³ç°¿ãªã©ã‚’ä¸€åˆ‡ã¤ã‘ã¦ãŠã‚‰ãšã€ãƒ¬ã‚¸é‡‘é¡ãƒ™ãƒ¼ã‚¹ã§é›†è¨ˆã—ã¦ãŠã‚Šã€ã“ã‚Œã‚’è‡ªå‹•åŒ–ã—ãŸã„ã¨è€ƒãˆãŸã‹ã‚‰ã€‚

### ç›®æŒ‡ã™å§¿
POSãƒ¬ã‚¸ã‚’å°å…¥ã™ã‚‹ã«ã¯å°‘ã—é‡ã„ã€çŸ­æœŸé–“ã®ã‚¤ãƒ™ãƒ³ãƒˆäº‹ã«å°å…¥ã—ã‚„ã™ã„ä¼šè¨ˆã‚µãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹

### å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ
* ä¸€èˆ¬çš„ãªä¼šè¨ˆã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ˆã†ãªè¤‡é›‘ãªè¨­å®šãŒä¸è¦
* POSãƒ¬ã‚¸ç­‰ã®è¿½åŠ æ©ŸæãŒä¸è¦

---

## å®Ÿè£…ã‚’äºˆå®šã—ã¦ã„ã‚‹æ©Ÿèƒ½


### MVP
| æ©Ÿèƒ½ | è©³ç´° |
|------|------|
| **ä¼šå“¡ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³** | ãƒ¡ãƒ¼ãƒ« + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| **å•†å“ç™»éŒ²** | åå‰,ä¾¡æ ¼å…¥åŠ›ã®CRUD |
| **ä¼šè¨ˆç”»é¢** | å•†å“ã‚«ãƒ¼ãƒ‰ã®Â±ãƒœã‚¿ãƒ³ã§æ•°é‡é¸æŠ â†’ åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®— |
| **è²©å£²ãƒ­ã‚°ä¿å­˜** | ä¼šè¨ˆç”»é¢ã§è²©å£²ãƒ­ã‚°ã‚’ä¿å­˜ |
| **å½“æ—¥æ—¥å ±è‡ªå‹•ç”Ÿæˆ** | PDFï¼CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |


### ãã®å¾Œã®æ©Ÿèƒ½
| æ©Ÿèƒ½             | è©³ç´°                   |
| -------------- | -------------------- |
| **ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** | éå»ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¤‡è£½ã—ã¦ä¸€æ‹¬ã‚»ãƒƒãƒˆ     |
| **å•†å“ç™»éŒ²** | å•†å“ç”»åƒã€ã‚¿ã‚°ã®è¿½åŠ ã€CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ  |
| **åœ¨åº«ç®¡ç†**           | æ®‹ã‚Šåœ¨åº«ã«å¿œã˜ã¦å•†å“è¡¨ç¤º         |
| **å¤šç«¯æœ«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**   | ä¼šè¨ˆç”¨ç”»é¢ã¨å—ã‘æ¸¡ã—ç”¨ç”»é¢ã®ä½œæˆ     |
| **ç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**  | å£²ä¸Šåˆè¨ˆãƒ»æ™‚é–“å¸¯åˆ¥å£²ä¸Šãƒ»TOPå•†å“ã‚’è¡¨ç¤º |

## â–  æ©Ÿèƒ½å€™è£œ

### ã€MVP ãƒªãƒªãƒ¼ã‚¹ã€‘
- ä¼šå“¡ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³  
  - ãƒ¡ãƒ¼ãƒ«ï¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
- å•†å“ç™»éŒ² CRUD 
  - åå‰ãƒ»ä¾¡æ ¼ï¼ˆï¼‹ä»»æ„ã§ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼‰
- ä¼šè¨ˆç”»é¢  
  - å•†å“ã‚«ãƒ¼ãƒ‰ã® Â± ãƒœã‚¿ãƒ³ã§æ•°é‡å¤‰æ›´ â†’ åˆè¨ˆé‡‘é¡ã‚’å³æ™‚è¨ˆç®—
  - ã‚«ãƒ¼ãƒ‰ã«ã¯å˜ä¾¡ã¨é¸æŠå€‹æ•°ã‚‚è¡¨ç¤º
- è²©å£²ãƒ­ã‚°ä¿å­˜  
  - ä¼šè¨ˆç¢ºå®šæ™‚ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
- å½“æ—¥æ—¥å ±è‡ªå‹•ç”Ÿæˆ
  - å£²ä¸Šãƒ»å€‹æ•°ã‚’é›†è¨ˆã‚’ç”»é¢è¡¨ç¤º
  - é›†è¨ˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦å‡ºåŠ›ï¼ˆcsvï¼‰

---

### ã€æœ¬ãƒªãƒªãƒ¼ã‚¹ã€‘
- ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¤‡è£½ 
  - éå»ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šãƒ»å•†å“ã‚’ä¸€æ‹¬ã‚³ãƒ”ãƒ¼
- å•†å“ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ 
  - ç”»åƒä»˜ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- åœ¨åº«ç®¡ç† 
  - æ®‹æ•°ã«å¿œã˜ãŸå£²ã‚Šåˆ‡ã‚Œè¡¨ç¤ºãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
- å¤šç«¯æœ«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆãƒšã‚¢ç”»é¢ãƒ¢ãƒ¼ãƒ‰ï¼‰ 
  - ä¼šè¨ˆç”¨ç«¯æœ«ã¨å—ã‘æ¸¡ã—ç”¨ç«¯æœ«ã‚’åŒæœŸ
- ç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ 
  - æ—¥åˆ¥ï¼æ™‚é–“å¸¯åˆ¥å£²ä¸Šãƒ»TOPå•†å“ã‚’è¡¨ç¤º
- ç®¡ç†æ¨©é™ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ï¼ã‚¹ã‚¿ãƒƒãƒ•ï¼‰ 
  - æ¨©é™ã«ã‚ˆã‚‹ç”»é¢ãƒ»æ“ä½œåˆ¶å¾¡
- æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆPDFï¼‰ 
  - ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
- ãƒ‡ãƒ¼ã‚¿ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ 
- 

---

## â–  æ©Ÿèƒ½ã®å®Ÿè£…æ–¹é‡äºˆå®š


### ä¼šè¨ˆç”»é¢
- React ã§ä»®æƒ³ POSã€‚å•†å“ä¸€è¦§ã‚’ SWR ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚  
- åˆè¨ˆé‡‘é¡ã¯ Zustand ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ã€æ•°å€¤æ¼”ç®—ã®ã¿ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã€‚  
- ç”»é¢é·ç§»ç„¡ã—ï¼å…¨ä½“ã‚’ã‚³ãƒ³ãƒã‚¸ãƒƒãƒˆåŒ–ã—ã¦ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã€‚

### è²©å£²ãƒ­ã‚°ä¿å­˜
- POST `/api/sales` ã§ 1 ä¼šè¨ˆåˆ†ã‚’ JSON é€ä¿¡ã€‚  
- éšœå®³æ™‚ã®ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã« IndexedDB ã¸ã‚­ãƒ¥ãƒ¼ â†’ ãƒãƒƒãƒˆå¾©å¸°æ™‚ã«åŒæœŸã€‚  
- Rails ã§ DB ã¸æ›¸ãè¾¼ã¿ã€‚å¤–éƒ¨æ•´åˆæ€§ç¢ºä¿ã®ãŸã‚ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ & æ¥½è¦³ãƒ­ãƒƒã‚¯ã€‚

### å½“æ—¥æ—¥å ±è‡ªå‹•ç”Ÿæˆ
- Rails Active Job ã§ Prawnï¼ˆPDFï¼‰ï¼‹æ¨™æº– CSV Builderã€‚  
- å‡¦ç†å®Œäº†å¾Œã« presigned URL ã‚’è¿”ã—ã€React Toast ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¡ˆå†…ã€‚  
- æœ¬ãƒªãƒªãƒ¼ã‚¹ã§ã¯ Sidekiq + sidekiq-scheduler ã§è‡ªå‹•ãƒãƒƒãƒã‚‚è¿½åŠ ã€‚

### ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¤‡è£½
- `events` ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ `event_items` ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”¨æ„ã€‚  
- `Event#duplicate!` ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã§å­ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ deep copyã€‚

### åœ¨åº«ç®¡ç†
- `stocks` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼š`item_id`, `quantity`.  
- ä¼šè¨ˆç¢ºå®šæ™‚ã«æ®‹æ•°ã‚’ Decrementã€‚0 ã§å£²ã‚Šåˆ‡ã‚Œãƒ•ãƒ©ã‚° broadcastã€‚  
- ä½åœ¨åº«é–¾å€¤ã¯ç’°å¢ƒå¤‰æ•° or UI ã§è¨­å®šå¯èƒ½ã«ã€‚

### å¤šç«¯æœ«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
- **Action Cable** + Redisã€‚  
- ãƒãƒ£ãƒãƒ«: `SalesChannel`, `StockChannel`.  
- React å´ã¯ `@rails/actioncable` ã§æ¥ç¶šã€`useEffect` ã§ state æ›´æ–°ã€‚  
- ãƒ¢ãƒã‚¤ãƒ«ã¨ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§åŒä¸€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ï¼ˆPWA å¯¾å¿œï¼‰ã€‚

### ç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- Rails ã§é›†è¨ˆ SQLï¼ˆGROUP BY date_trunc, hourï¼‰ã€‚CacheStore ã«ãƒ¡ãƒ¢åŒ–ã€‚  
- API `/api/analytics/summary` ã‚’ä½œæˆã— JSON è¿”å´ã€‚  
- React ã§ Rechartsã€‚ã‚«ãƒ¼ãƒ‰ï¼ãƒãƒ£ãƒ¼ãƒˆã¯ Tailwind Grid + Aspect-ratioã€‚

### ç®¡ç†æ¨©é™
- `role` ã‚«ãƒ©ãƒ ï¼‹ Punditã€‚  
- React Router ã§ `PrivateRoute` å®ˆè¡›ã‚’å®Ÿè£…ã€‚  
- ãƒãƒ¼ãƒ æ‹›å¾…ã¯ Magic Link (ActionMailer) + Token ãƒ™ãƒ¼ã‚¹ã€‚

### ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½
- Action Mailer + SES ã‚‚ã—ãã¯ SendGridã€‚  
- HTML ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ MJML â†’ Premailer ã§ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ã€‚  
- Active Job ã§éåŒæœŸã€sidekiq-scheduler ã§ã€Œã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº† 5 åˆ†å¾Œã«æ—¥å ±ã€ã‚’è‡ªå‹•é€ä¿¡ã€‚

---



# ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ï¼ˆæœ¬ãƒªãƒªãƒ¼ã‚¹ï¼‰


- **ãƒ›ãƒ¼ãƒ **


- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**
  - æ–°è¦ç™»éŒ²
  - ãƒ­ã‚°ã‚¤ãƒ³
  - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š


- **ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†**
  - ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
  - æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
  - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰è¤‡è£½
  - **ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°**
    - å•†å“è¨­å®š
    - åœ¨åº«çŠ¶æ³

- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**
  - å£²ä¸Šã‚µãƒãƒªãƒ¼
  - æ™‚é–“å¸¯åˆ¥å£²ä¸Š
  - TOPå•†å“
  - ä½åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆ

- **ä¼šè¨ˆï¼ˆPOSï¼‰**
  - ãƒ¡ã‚¤ãƒ³ä¼šè¨ˆç”»é¢
  - å—ã‘æ¸¡ã—ç”»é¢ï¼ˆãƒšã‚¢ç«¯æœ«ï¼‰

- **å•†å“ç®¡ç†**
  - å•†å“ä¸€è¦§
  - å•†å“è¿½åŠ ï¼ç·¨é›†
  - ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

- **åœ¨åº«ç®¡ç†**
  - åœ¨åº«ä¸€è¦§
  - åœ¨åº«èª¿æ•´
  - å£²ã‚Šåˆ‡ã‚Œè¨­å®š
  - ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤è¨­å®š

- **è²©å£²ãƒ­ã‚°**
  - ä¼šè¨ˆå±¥æ­´
  - æ—¥åˆ¥é›†è¨ˆ
  - è©³ç´°æ¤œç´¢
  - **ãƒ¬ãƒãƒ¼ãƒˆ**
    - æ—¥å ±PDFå‡ºåŠ›
    - CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    - ãƒ¡ãƒ¼ãƒ«é€ä¿¡


- **ãƒãƒ¼ãƒ ç®¡ç†**
  - ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§
  - å½¹å‰²è¨­å®šï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ï¼ã‚¹ã‚¿ãƒƒãƒ•ï¼‰


- **æ³•å‹™é–¢é€£**
  - åˆ©ç”¨è¦ç´„
  - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼

- **å•ã„åˆã‚ã›**


# ç”»é¢é·ç§»å›³
https://www.figma.com/board/pU5HUkmnktmMabQC9c12Eb/Event%E3%83%AC%E3%82%B8?node-id=0-1&t=2fwiZLm8uyC3iyLE-1

# ç”»é¢è¨­è¨ˆãƒ‡ãƒ¢
https://v0.dev/chat/pos-system-design-omoaZLrkM6Y


# ERå›³
https://dbdiagram.io/d/event%E3%83%AC%E3%82%B8-682fe17cb9f7446da3c8fcde




è¿½åŠ è¦ä»¶
* å‰²å¼•
  * ãƒœã‚¿ãƒ³ã§0.8æ›ã‘


# ==================================================
# Railså®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ï¼ˆé †ç•ªã«å®Ÿè¡Œï¼‰
# ==================================================

# ============== 1. åŸºæœ¬è¨­å®šãƒ»Gemè¿½åŠ  ==============

# DeviseãŒã¾ã ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆ
# Gemfileã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ã‹ã‚‰bundle install
echo "gem 'devise'" >> Gemfile
bundle install

# Deviseã®åˆæœŸè¨­å®šï¼ˆã¾ã ã®å ´åˆï¼‰
rails generate devise:install
rails generate devise User

# ============== 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ ==============

# ãƒ­ãƒ¼ãƒ«ï¼ˆrolesï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
rails generate migration CreateRoles name:string:uniq

# å•†å“ã‚«ãƒ†ã‚´ãƒªï¼ˆitem_categoriesï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
rails generate migration CreateItemCategories name:string:uniq

# ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆeventsï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
rails generate migration CreateEvents name:string date:date

# ã‚¤ãƒ™ãƒ³ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼ˆevent_membersï¼‰ãƒ†ãƒ¼ãƒ–ãƒ« - è¤‡åˆä¸»ã‚­ãƒ¼
rails generate migration CreateEventMembers event:references user:references role:references

# å•†å“ï¼ˆitemsï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
rails generate migration CreateItems event:references item_category:references name:string price:integer image_url:string jan_code:string

# åœ¨åº«ï¼ˆstocksï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
rails generate migration CreateStocks item:references quantity:integer

# å£²ä¸Šï¼ˆsalesï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
rails generate migration CreateSales event:references subtotal_amount:integer is_discount:boolean discount_rate:decimal discount_amount:integer discounted_subtotal:integer tax_rate:decimal tax_amount:integer total_amount:integer is_reservation:boolean sold_at:datetime

# å£²ä¸Šæ˜ç´°ï¼ˆsale_itemsï¼‰ãƒ†ãƒ¼ãƒ–ãƒ«
rails generate migration CreateSaleItems sale:references item:references quantity:integer unit_price:integer line_subtotal:integer

# ç¨è¾¼ãƒ•ãƒ©ã‚°è¿½åŠ 
rails generate migration AddTaxIncludedToSales is_tax_included:boolean

# ============== 3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«æ‰‹å‹•ä¿®æ­£ ==============

# ç”Ÿæˆã•ã‚ŒãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
echo "ä»¥ä¸‹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹å‹•ã§ä¿®æ­£ã—ã¦ãã ã•ã„ï¼š"

echo "
# db/migrate/xxx_create_event_members.rb
class CreateEventMembers < ActiveRecord::Migration[7.0]
  def change
    create_table :event_members, primary_key: [:event_id, :user_id] do |t|
      t.references :event, null: false, foreign_key: true
      t.references :user, null: false, foreign_key: true
      t.references :role, null: false, foreign_key: true
      t.timestamps
    end
  end
end
"

echo "
# db/migrate/xxx_create_stocks.rb
class CreateStocks < ActiveRecord::Migration[7.0]
  def change
    create_table :stocks, id: false do |t|
      t.references :item, null: false, foreign_key: true, primary_key: true
      t.integer :quantity
      t.timestamp :updated_at
    end
    
    add_index :stocks, :item_id, unique: true
  end
end
"

echo "
# db/migrate/xxx_create_sales.rb ã§ä»¥ä¸‹ã®å±æ€§ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šï¼š
# t.boolean :is_discount, null: false, default: false
# t.decimal :discount_rate, precision: 5, scale: 2, default: 0.00
# t.integer :discount_amount, default: 0
# t.decimal :tax_rate, precision: 5, scale: 2, default: 10.00
# t.boolean :is_reservation, null: false, default: false
# t.datetime :sold_at, default: -> { 'CURRENT_TIMESTAMP' }
"

echo "
# db/migrate/xxx_add_tax_included_to_sales.rb
class AddTaxIncludedToSales < ActiveRecord::Migration[7.0]
  def change
    add_column :sales, :is_tax_included, :boolean, default: false, null: false
  end
end
"

# ============== 4. ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ ==============

# ãƒ¢ãƒ‡ãƒ«ç”Ÿæˆï¼ˆé–¢é€£ä»˜ã‘ã¯æ‰‹å‹•ã§è¿½åŠ ï¼‰
rails generate model Role --skip-migration
rails generate model ItemCategory --skip-migration
rails generate model Event --skip-migration
rails generate model EventMember --skip-migration
rails generate model Item --skip-migration
rails generate model Stock --skip-migration
rails generate model Sale --skip-migration
rails generate model SaleItem --skip-migration

# ============== 5. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç”Ÿæˆ ==============

# APIç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç”Ÿæˆ
rails generate controller Api::Events --skip-routes
rails generate controller Api::Items --skip-routes
rails generate controller Api::Sales --skip-routes
rails generate controller Api::Stocks --skip-routes

# é€šå¸¸ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆç®¡ç†ç”»é¢ç”¨ï¼‰
rails generate controller Events
rails generate controller Items
rails generate controller Sales

# ============== 6. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š ==============

echo "config/routes.rbã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š"

echo "
Rails.application.routes.draw do
  devise_for :users
  root 'events#index'

  # é€šå¸¸ã®ãƒ«ãƒ¼ãƒˆ
  resources :events do
    resources :items
    resources :sales
    member do
      get :pos # POSã‚·ã‚¹ãƒ†ãƒ ç”»é¢
    end
  end

  # APIãƒ«ãƒ¼ãƒˆ
  namespace :api do
    resources :events, only: [:index, :show] do
      resources :items, only: [:index, :show]
      resources :sales, only: [:create, :show, :index]
      resources :stocks, only: [:show, :update]
    end
  end
end
"

# ============== 7. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ ==============

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
rails db:create

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
rails db:migrate

# ============== 8. ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ä½œæˆãƒ»å®Ÿè¡Œ ==============

echo "db/seeds.rbã«åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼ˆå‰å›ã®artifactã‚’å‚ç…§ï¼‰"

# ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å®Ÿè¡Œ
rails db:seed

# ============== 9. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆï¼ˆé–‹ç™ºç”¨ï¼‰ ==============

# Railsã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
rails console

# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã§å®Ÿè¡Œã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹
echo "
# Railsã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼š

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
user = User.create!(
  email: 'admin@example.com',
  password: 'password',
  password_confirmation: 'password',
  name: 'ç®¡ç†è€…'
)

# ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
event = Event.create!(
  name: 'æ˜¥ç¥­ã‚Š2025',
  date: Date.current + 1.month
)

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã«è¿½åŠ 
role = Role.find_by(name: 'ç®¡ç†è€…')
EventMember.create!(event: event, user: user, role: role)

# å•†å“ä½œæˆ
drink_category = ItemCategory.find_by(name: 'é£²ã¿ç‰©')
food_category = ItemCategory.find_by(name: 'é£Ÿã¹ç‰©')

items = [
  { name: 'ãŸã“ç„¼ã', price: 500, category: food_category },
  { name: 'ç„¼ããã°', price: 600, category: food_category },
  { name: 'ã‹ãæ°·', price: 300, category: drink_category },
  { name: 'ãƒ“ãƒ¼ãƒ«', price: 400, category: drink_category },
  { name: 'ãƒ•ãƒ©ãƒ³ã‚¯ãƒ•ãƒ«ãƒˆ', price: 350, category: food_category },
  { name: 'ã‚¸ãƒ¥ãƒ¼ã‚¹', price: 200, category: drink_category },
  { name: 'ãŠå¥½ã¿ç„¼ã', price: 550, category: food_category },
  { name: 'ç¶¿ã‚ã‚', price: 250, category: nil }
]

items.each do |item_data|
  item = event.items.create!(
    name: item_data[:name],
    price: item_data[:price],
    item_category: item_data[:category]
  )
  
  # åœ¨åº«è¨­å®š
  item.create_stock!(quantity: 50)
end

puts 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ'
exit
"

# ============== 10. ã‚µãƒ¼ãƒãƒ¼èµ·å‹• ==============

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
rails server

# ã¾ãŸã¯
rails s

# ============== 11. ç¢ºèªç”¨ã‚³ãƒãƒ³ãƒ‰ ==============

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ç¢ºèª
rails db:migrate:status

# ãƒ«ãƒ¼ãƒˆç¢ºèª
rails routes

# ãƒ¢ãƒ‡ãƒ«ç¢ºèª
rails console
# > User.count
# > Event.count
# > Item.count

# ============== 12. æœ¬ç•ªç’°å¢ƒç”¨ã‚³ãƒãƒ³ãƒ‰ ==============

# æœ¬ç•ªç’°å¢ƒã§ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
RAILS_ENV=production rails db:migrate

# æœ¬ç•ªç’°å¢ƒã§ã®ã‚·ãƒ¼ãƒ‰å®Ÿè¡Œ
RAILS_ENV=production rails db:seed

# ã‚¢ã‚»ãƒƒãƒˆã®ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
RAILS_ENV=production rails assets:precompile

# ============== æ³¨æ„äº‹é … ==============

echo "
âš ï¸  é‡è¦ãªæ³¨æ„äº‹é …ï¼š

1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç”Ÿæˆå¾Œã«æ‰‹å‹•ä¿®æ­£ãŒå¿…è¦ã§ã™
2. ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ä»˜ã‘ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
3. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„
4. ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„
5. èªè¨¼ãƒ»èªå¯ã®å®Ÿè£…ã‚’å¿˜ã‚Œãšã«

ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š
1. ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’é †ç•ªã«å®Ÿè¡Œ
2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£
3. ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰å›ã®artifactã®å†…å®¹ã§æ›´æ–°
4. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè£…
5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã®é€£æºãƒ†ã‚¹ãƒˆ
"

# ============== ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒãƒ³ãƒ‰ ==============

# ãƒ­ã‚°ç¢ºèª
tail -f log/development.log

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…å®¹ç¢ºèª
rails dbconsole
# ã¾ãŸã¯
rails db

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
rails test

# RuboCopã§ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆgem 'rubocop'ãŒå¿…è¦ï¼‰
bundle exec rubocop

echo "å…¨ã¦ã®ã‚³ãƒãƒ³ãƒ‰ã®æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸï¼é †ç•ªã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚"

dce web rails generate model Role --skip-migration
dce web rails generate model ItemCategory --skip-migration
dce web rails generate model Event --skip-migration
dce web rails generate model EventMember --skip-migration
dce web rails generate model Item --skip-migration
dce web rails generate model Stock --skip-migration
dce web rails generate model Sale --skip-migration
dce web rails generate model SaleItem --skip-migration

dce web rails generate controller Api::v1::Events --skip-routes
dce web rails generate controller Api::v1::Items --skip-routes
dce web rails generate controller Api::v1::Sales --skip-routes
dce web rails generate controller Api::v1::Stocks --skip-routes

dce web rails generate controller Events
dce web rails generate controller Items
dce web rails generate controller Sales